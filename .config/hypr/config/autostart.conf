# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃                    Autostart Configuration                  ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

source = ~/.config/hypr/config/defaults.conf

exec-once = sh -lc 'chmod +x "$HOME/.config/hypr/scripts/monitor-watch.sh" 2>/dev/null || true; "$HOME/.config/hypr/scripts/monitor-watch.sh" & disown'
# start swww once and set wallpaper
exec-once = sh -c 'command -v swww >/dev/null && (pgrep -x swww-daemon >/dev/null || swww-daemon)'

exec-once = kanshi &
exec-once = fusuma
exec = sh -c 'sleep 1; pgrep -x hyprpanel >/dev/null || HYPRPANEL_CONFIG="$HOME/.config/hyprpanel/config.json" /usr/share/hyprpanel/hyprpanel-app >/tmp/hyprpanel.log 2>&1 &'
exec-once = rfkill unblock bluetooth
# exec-once = hyprpaper  # replaced by swww
exec-once = hyprctl setcursor catppuccin-mocha-blue-cursors 24
exec-once = fcitx5 -d
exec-once = nm-applet --indicator
exec-once = bash -c "mkfifo /tmp/$HYPRLAND_INSTANCE_SIGNATURE.wob && tail -f /tmp/$HYPRLAND_INSTANCE_SIGNATURE.wob | wob -c ~/.config/hypr/wob.ini & disown"
exec-once = /usr/lib/polkit-kde-authentication-agent-1
exec-once = tailscale-systray 2>/dev/null


# Reapply wallpaper on reloads (covers some hotplug cases)
exec = sh -c 'command -v swww >/dev/null && (pgrep -x swww-daemon >/dev/null || swww-daemon) && sleep 0.3 && swww img "$HOME/Backgrounds/scenic-dusk-seascape-kbu7tt9qyrucl469_catppuccin-mocha.jpg" --resize crop --transition-step 15 --transition-type grow'

# Re-assert hyprpanel after reloads or display changes
exec = sh -lc 'LOG=/tmp/hyprpanel.log; BIN="/usr/share/hyprpanel/hyprpanel-app"; CFG="$HOME/.config/hyprpanel/config.json"; for i in 1 2 3 4 5; do sleep 0.6; if command -v jq >/dev/null 2>&1; then hyprctl clients -j | jq -e ".[] | select((.class==\"hyprpanel\" or .initialClass==\"hyprpanel\" or .title==\"HyprPanel\"))" >/dev/null 2>&1 && exit 0; else hyprctl clients | grep -qi hyprpanel && exit 0; fi; done; if pgrep -x hyprpanel >/dev/null || pgrep -f "$BIN" >/dev/null; then pkill -x hyprpanel || true; pkill -f "$BIN" || true; sleep 0.2; fi; HYPRPANEL_CONFIG="$CFG" "$BIN" >>"$LOG" 2>&1 &'

# ## Slow app launch fix
exec-once = systemctl --user import-environment &
exec-once = hash dbus-update-activation-environment 2>/dev/null &
exec-once = dbus-update-activation-environment --systemd &
